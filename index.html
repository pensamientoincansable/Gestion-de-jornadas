<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Telepizza - Gestión de Jornadas</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Logo cambiado a color blanco -->
        <div class="logo">
            <h1 style="color: white !important; -webkit-text-fill-color: white; background: none; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);">Telepizza</h1>
            <span>Gestión de Jornadas</span>
        </div>
        
        <!-- Selección de rol -->
        <div class="selector active">
            <h2>Selecciona tu rol</h2>
            <button class="btn" id="btnTelepizzero">
                <i class="fas fa-user-clock"></i> Telepizzero
            </button>
            <button class="btn" id="btnGerencia">
                <i class="fas fa-chart-line"></i> Gerencia
            </button>
        </div>
        
        <!-- Sección para telepizzeros -->
        <div class="telepizzero-section">
            <h2><i class="fas fa-user-clock"></i> Registro de Jornada</h2>
            
            <div class="permiso-geolocalizacion" id="permisoGeolocalizacion">
                <h3><i class="fas fa-map-marker-alt"></i> Activación de Geolocalización</h3>
                <p>Para registrar tu jornada, necesitamos acceder a tu ubicación.</p>
                <p>Haz clic en "Activar Geolocalización" y permite el acceso cuando tu navegador lo solicite.</p>
                <div class="loader" id="loaderGeolocalizacion" style="display: none;"></div>
                <button class="btn btn-success" id="btnActivarGeolocalizacion">
                    <i class="fas fa-location-crosshairs"></i> Activar Geolocalización
                </button>
            </div>
            
            <div id="contenidoFichaje" style="display: none;">
                <div class="form-group">
                    <label for="dniInput"><i class="fas fa-id-card"></i> Introduce tu DNI (8 dígitos)</label>
                    <input type="text" id="dniInput" placeholder="Ej: 00000000" maxlength="8" inputmode="numeric">
                    <small style="color: #FFC72C; font-size: 0.9rem;">Solo números, sin letras</small>
                </div>
                
                <!-- Teclado numérico -->
                <div class="teclado-numerico">
                    <div class="teclado-fila">
                        <button class="tecla-numero" data-numero="1">1</button>
                        <button class="tecla-numero" data-numero="2">2</button>
                        <button class="tecla-numero" data-numero="3">3</button>
                    </div>
                    <div class="teclado-fila">
                        <button class="tecla-numero" data-numero="4">4</button>
                        <button class="tecla-numero" data-numero="5">5</button>
                        <button class="tecla-numero" data-numero="6">6</button>
                    </div>
                    <div class="teclado-fila">
                        <button class="tecla-numero" data-numero="7">7</button>
                        <button class="tecla-numero" data-numero="8">8</button>
                        <button class="tecla-numero" data-numero="9">9</button>
                    </div>
                    <div class="teclado-fila">
                        <button class="tecla-numero tecla-borrar" id="teclaBorrar"><i class="fas fa-backspace"></i></button>
                        <button class="tecla-numero" data-numero="0">0</button>
                        <button class="tecla-numero tecla-limpiar" id="teclaLimpiar"><i class="fas fa-times"></i></button>
                    </div>
                </div>
                
                <button class="btn btn-success" id="btnFichar">
                    <i class="fas fa-fingerprint"></i> Fichar Entrada/Salida
                </button>
                
                <div class="geolocalizacion-info" id="infoGeolocalizacion" style="display: none;">
                    <h3><i class="fas fa-map-marker-alt"></i> Ubicación Detectada</h3>
                    <div id="estadoGeolocalizacion">Obteniendo ubicación...</div>
                    <div class="coordenadas" id="coordenadas"></div>
                    <div class="ubicacion-aproximada" id="direccionAproximada"></div>
                    <div class="mapa" id="mapaContainer">
                        <div id="mapaPlaceholder">Mapa se cargará aquí</div>
                    </div>
                </div>
                
                <div class="mensaje" id="mensajeTelepizzero"></div>
            </div>
            
            <!-- Botón volver con texto rojo -->
            <button class="btn volver-btn" id="volverTelepizzero" style="color: #D4001C !important; border-color: #D4001C; background: rgba(212, 0, 28, 0.1);">
                <i class="fas fa-arrow-left" style="color: #D4001C;"></i> Volver al Menú
            </button>
        </div>
        
        <!-- Sección para gerencia -->
        <div class="gerencia-section">
            <h2><i class="fas fa-chart-line"></i> Acceso Gerencia</h2>
            <div class="form-group">
                <label for="passwordInput"><i class="fas fa-key"></i> Contraseña</label>
                <input type="password" id="passwordInput" placeholder="Introduce la contraseña" inputmode="numeric">
            </div>
            <button class="btn" id="btnAcceder">
                <i class="fas fa-sign-in-alt"></i> Acceder
            </button>
            <div class="mensaje" id="mensajeGerencia"></div>
            <!-- Botón volver con texto rojo -->
            <button class="btn volver-btn" id="volverGerencia" style="color: #D4001C !important; border-color: #D4001C; background: rgba(212, 0, 28, 0.1);">
                <i class="fas fa-arrow-left" style="color: #D4001C;"></i> Volver
            </button>
        </div>
        
        <!-- Sección de gestión para gerencia -->
        <div class="registro-section">
            <h2><i class="fas fa-tachometer-alt"></i> Panel de Gerencia <span class="badge">En línea</span></h2>
            
            <div class="gerencia-container">
                <!-- Navegación lateral vertical - Cambiada Semanas por Exportar -->
                <div class="navegacion-vertical">
                    <div class="nav-item active" data-tab="registros">
                        <i class="fas fa-clipboard-list"></i>
                        <span>Registros</span>
                    </div>
                    <div class="nav-item" data-tab="usuarios">
                        <i class="fas fa-users"></i>
                        <span>Usuarios</span>
                    </div>
                    <div class="nav-item" data-tab="ausencias">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Ausencias</span>
                    </div>
                    <div class="nav-item" data-tab="correo">
                        <i class="fas fa-envelope"></i>
                        <span>Correo</span>
                    </div>
                    <div class="nav-item" data-tab="exportar">
                        <i class="fas fa-file-export"></i>
                        <span>Exportar</span>
                    </div>
                </div>
                
                <!-- Contenido principal -->
                <div class="contenido-principal">
                    <!-- Pestaña de Registros -->
                    <div class="tab-content active" id="registros-tab">
                        <h3><i class="fas fa-clipboard-list"></i> Registro de Jornadas</h3>
                        
                        <div class="filtros">
                            <div class="filtro-group">
                                <label for="filtroPuesto">Puesto:</label>
                                <select id="filtroPuesto">
                                    <option value="">Todos</option>
                                    <option value="auxiliar">Auxiliar</option>
                                    <option value="repartidor">Repartidor</option>
                                    <option value="encargado">Encargado</option>
                                    <option value="limpieza">Limpieza</option>
                                </select>
                            </div>
                            
                            <div class="filtro-group">
                                <label for="filtroVista">Vista:</label>
                                <select id="filtroVista">
                                    <option value="semana">Semana actual</option>
                                    <option value="dia">Día específico</option>
                                    <option value="rango">Rango fechas</option>
                                </select>
                            </div>
                            
                            <!-- Selector de semana -->
                            <div id="selectorSemana" class="filtro-group selector-fecha">
                                <label for="filtroSemana">Semana:</label>
                                <input type="week" id="filtroSemana">
                            </div>
                            
                            <!-- Selector de día -->
                            <div id="selectorDia" class="filtro-group selector-fecha" style="display: none;">
                                <label for="filtroDia">Día:</label>
                                <input type="date" id="filtroDia">
                            </div>
                            
                            <!-- Selector de rango -->
                            <div id="selectorRango" class="filtro-group selector-fecha" style="display: none;">
                                <label for="filtroDesde">Desde:</label>
                                <input type="date" id="filtroDesde">
                                <label for="filtroHasta">Hasta:</label>
                                <input type="date" id="filtroHasta">
                            </div>
                            
                            <div class="botones-filtro">
                                <button class="btn btn-secondary btn-small" id="btnFiltrar">
                                    <i class="fas fa-filter"></i> Filtrar
                                </button>
                                <button class="btn btn-gris btn-small" id="btnResetFiltros">
                                    <i class="fas fa-redo"></i> Reset
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table id="tablaRegistros">
                                <thead>
                                    <tr>
                                        <th><i class="fas fa-user"></i> Nombre</th>
                                        <th><i class="fas fa-id-card"></i> DNI</th>
                                        <th><i class="fas fa-briefcase"></i> Puesto</th>
                                        <th><i class="fas fa-calendar-day"></i> Fecha</th>
                                        <th><i class="fas fa-sign-in-alt"></i> Entrada</th>
                                        <th><i class="fas fa-sign-out-alt"></i> Salida</th>
                                        <th><i class="fas fa-clock"></i> Horas</th>
                                        <th><i class="fas fa-map-marker-alt"></i> Ubicación</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Los registros se llenarán con JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="total-horas" id="totalHoras"></div>
                    </div>
                    
                    <!-- Pestaña de Gestión de Usuarios - Añadida opción para cambiar puesto -->
                    <div class="tab-content" id="usuarios-tab">
                        <div class="usuarios-header">
                            <h3><i class="fas fa-users"></i> Gestión de Telepizzeros</h3>
                            <div class="form-agregar-usuario">
                                <input type="text" id="nuevoDni" placeholder="DNI (8 dígitos)" maxlength="8" inputmode="numeric">
                                <input type="text" id="nuevoNombre" placeholder="Nombre completo">
                                <select id="nuevoPuesto">
                                    <option value="auxiliar">Auxiliar</option>
                                    <option value="repartidor">Repartidor</option>
                                    <option value="encargado">Encargado</option>
                                    <option value="limpieza">Limpieza</option>
                                </select>
                                <button class="btn btn-secondary btn-small" id="btnAgregarUsuario">
                                    <i class="fas fa-plus"></i> Agregar
                                </button>
                            </div>
                        </div>
                        
                        <div class="usuarios-container">
                            <h4><i class="fas fa-list"></i> Lista de Telepizzeros</h4>
                            <div class="usuarios-scroll" id="listaUsuarios">
                                <!-- Lista de usuarios se llenará con JavaScript -->
                                <div class="usuario-vacio">
                                    <i class="fas fa-user-plus fa-2x"></i>
                                    <p>No hay usuarios registrados</p>
                                    <p class="texto-pequeno">Agrega el primer telepizzero</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pestaña de Control de Ausencias -->
                    <div class="tab-content" id="ausencias-tab">
                        <h3><i class="fas fa-exclamation-triangle"></i> Control de Ausencias</h3>
                        
                        <div class="form-ausencia">
                            <div class="form-group-compact">
                                <label for="selectUsuarioAusencia"><i class="fas fa-user"></i> Telepizzero</label>
                                <select id="selectUsuarioAusencia">
                                    <!-- Opciones se llenarán con JavaScript -->
                                </select>
                            </div>
                            
                            <div class="form-group-compact">
                                <label for="fechaAusencia"><i class="fas fa-calendar-day"></i> Fecha</label>
                                <input type="date" id="fechaAusencia">
                            </div>
                            
                            <div class="form-group-compact">
                                <label for="tipoAusencia"><i class="fas fa-exclamation-circle"></i> Tipo</label>
                                <select id="tipoAusencia">
                                    <option value="falta">❌ Falta</option>
                                    <option value="ausencia_justificada">⚠️ Justificada</option>
                                    <option value="retraso">⏰ Retraso</option>
                                </select>
                            </div>
                            
                            <div class="form-group-compact">
                                <label for="motivoAusencia"><i class="fas fa-comment"></i> Motivo</label>
                                <input type="text" id="motivoAusencia" placeholder="Motivo (opcional)">
                            </div>
                            
                            <button class="btn btn-secondary" id="btnRegistrarAusencia">
                                <i class="fas fa-clipboard-check"></i> Registrar Ausencia
                            </button>
                        </div>
                        
                        <h4><i class="fas fa-clipboard-list"></i> Historial de Incidencias</h4>
                        <div class="ausencias-container">
                            <div id="listaAusencias">
                                <!-- Lista de ausencias se llenará con JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pestaña de Configuración de Correo - Añadida gestión de correos destinatarios -->
                    <div class="tab-content" id="correo-tab">
                        <div class="correo-header">
                            <h3><i class="fas fa-envelope"></i> Configuración de Correo</h3>
                            <div class="correo-info">
                                <p><i class="fas fa-info-circle"></i> Los reportes se enviarán en formato PDF al correo configurado</p>
                                <p><strong>Correo por defecto:</strong> fichajetelepizza@outlook.es</p>
                            </div>
                        </div>
                        
                        <div class="correo-config">
                            <div class="form-group">
                                <label for="correoElectronico"><i class="fas fa-at"></i> Correo Electrónico</label>
                                <div class="input-with-button">
                                    <input type="email" id="correoElectronico" placeholder="fichajetelepizza@outlook.es" value="fichajetelepizza@outlook.es">
                                    <button class="btn btn-success" id="btnGuardarCorreo">
                                        <i class="fas fa-save"></i> Guardar
                                    </button>
                                </div>
                            </div>
                            
                            <div class="correo-guardado" id="infoCorreoGuardado">
                                <!-- Información del correo guardado se mostrará aquí -->
                            </div>
                            
                            <!-- Nuevo: Gestión de correos destinatarios -->
                            <div class="correo-destinatarios">
                                <h4><i class="fas fa-users"></i> Correos Destinatarios</h4>
                                <div class="input-with-button">
                                    <input type="email" id="nuevoCorreoDestinatario" placeholder="correo@ejemplo.com">
                                    <button class="btn btn-secondary btn-small" id="btnAgregarDestinatario">
                                        <i class="fas fa-plus"></i> Agregar
                                    </button>
                                </div>
                                <div id="listaDestinatarios" style="margin-top: 15px;">
                                    <!-- Lista de correos destinatarios se llenará con JavaScript -->
                                </div>
                            </div>
                            
                            <div class="correo-acciones">
                                <h4><i class="fas fa-paper-plane"></i> Enviar Reportes Manualmente</h4>
                                <p class="info-ayuda">Selecciona el tipo de informe y se enviará a todos los correos destinatarios</p>
                                
                                <div class="form-group-compact" style="margin: 15px 0;">
                                    <label for="tipoReporteEnvio"><i class="fas fa-file-pdf"></i> Tipo de Reporte</label>
                                    <select id="tipoReporteEnvio">
                                        <option value="diario">Diario (hoy)</option>
                                        <option value="rango">Rango de Fechas</option>
                                    </select>
                                </div>
                                
                                <!-- Selector de rango de fechas -->
                                <div id="selectorRangoEnvio" class="form-group-compact" style="display: none; margin: 15px 0;">
                                    <label for="fechaDesdeEnvio">Desde:</label>
                                    <input type="date" id="fechaDesdeEnvio">
                                    <label for="fechaHastaEnvio" style="margin-left: 10px;">Hasta:</label>
                                    <input type="date" id="fechaHastaEnvio">
                                </div>
                                
                                <div class="botones-envio">
                                    <button class="btn btn-reporte" id="btnEnviarReporteManual">
                                        <i class="fas fa-paper-plane"></i> Enviar Reporte
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mensaje" id="mensajeCorreo"></div>
                        </div>
                    </div>
                    
                    <!-- Pestaña de Exportar (antes Semanas) -->
                    <div class="tab-content" id="exportar-tab">
                        <h3><i class="fas fa-file-export"></i> Exportar Informes PDF</h3>
                        
                        <div class="exportar-filtros">
                            <div class="form-group-compact">
                                <label for="filtroPuestoExportar"><i class="fas fa-filter"></i> Filtrar por Puesto</label>
                                <select id="filtroPuestoExportar">
                                    <option value="">Todos los puestos</option>
                                    <option value="auxiliar">Auxiliar</option>
                                    <option value="repartidor">Repartidor</option>
                                    <option value="encargado">Encargado</option>
                                    <option value="limpieza">Limpieza</option>
                                </select>
                            </div>
                            
                            <div class="form-group-compact">
                                <label for="tipoReporteExportar"><i class="fas fa-file-pdf"></i> Tipo de Reporte</label>
                                <select id="tipoReporteExportar">
                                    <option value="diario">Diario (hoy)</option>
                                    <option value="semanal">Semanal (esta semana)</option>
                                    <option value="mensual">Mensual (este mes)</option>
                                    <option value="rango">Rango de Fechas</option>
                                </select>
                            </div>
                            
                            <!-- Selector de rango de fechas -->
                            <div id="selectorRangoExportar" class="form-group-compact" style="display: none;">
                                <label for="fechaDesdeExportar">Desde:</label>
                                <input type="date" id="fechaDesdeExportar">
                                <label for="fechaHastaExportar" style="margin-left: 10px;">Hasta:</label>
                                <input type="date" id="fechaHastaExportar">
                            </div>
                        </div>
                        
                        <div class="botones-exportar" style="margin-top: 30px;">
                            <button class="btn btn-success" id="btnExportarPDF">
                                <i class="fas fa-download"></i> Descargar PDF
                            </button>
                        </div>
                        
                        <div class="info-exportar" style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                            <h4><i class="fas fa-info-circle"></i> Información</h4>
                            <p>Los informes PDF incluirán:</p>
                            <ul style="margin-left: 20px; color: #FFC72C;">
                                <li>Nombre y DNI de empleados</li>
                                <li>Puesto y horas trabajadas</li>
                                <li>Fechas y horarios de entrada/salida</li>
                                <li>Total de horas por empleado</li>
                                <li>Resumen general</li>
                            </ul>
                            <p style="font-size: 0.9rem; margin-top: 10px;">
                                <i class="fas fa-exclamation-triangle"></i> Nota: Los informes NO incluyen información de geolocalización por privacidad.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Botón volver con texto rojo -->
            <button class="btn volver-btn" id="volverRegistro" style="color: #D4001C !important; border-color: #D4001C; background: rgba(212, 0, 28, 0.1);">
                <i class="fas fa-arrow-left" style="color: #D4001C;"></i> Volver al Menú
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="data.js"></script>
    <script src="email.js"></script>
    <script src="app.js"></script>
</body>
</html>
